<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Serial TCP Proxy</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="stylesheet" href="style.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
</head>

<body>
    <div class="app-container">
        <header class="header">
            <div class="logo">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 17l6-6-6-6M12 19h8" />
                </svg>
                <h1>Serial TCP Proxy</h1>
            </div>
            <div style="display: flex; gap: 1rem; align-items: center;">
                <button id="theme-toggle" class="btn-icon" title="Toggle Theme"><span>ðŸŒ™</span></button>
                <div class="status-badge" id="connection-status">
                    <span class="dot"></span>
                    <span class="text">Connecting...</span>
                </div>
            </div>
        </header>

        <main class="main-content">
            <div class="dashboard-grid">
                <!-- Stats Cards -->
                <div class="card stat-card">
                    <h3>Upstream</h3>
                    <div class="value auto-fit" id="upstream-addr">-</div>
                    <div class="label">Address</div>
                </div>
                <div class="card stat-card">
                    <h3>Listen Port</h3>
                    <div class="value" id="listen-port">-</div>
                    <div class="label">TCP Port</div>
                </div>
                <div class="card stat-card stat-card-clickable" id="clients-card" title="Click to manage clients">
                    <h3>Clients</h3>
                    <div class="value" id="client-count">0</div>
                    <div class="label">Connected</div>
                </div>
                <div class="card stat-card">
                    <h3>Uptime</h3>
                    <div class="value" id="uptime">-</div>
                    <div class="label">Since Start</div>
                </div>
            </div>

            <div class="tabs">
                <button class="tab-btn active" data-tab="logs">Live Logs</button>
                <button class="tab-btn" data-tab="inspector">Packet Inspector</button>
            </div>

            <div class="tab-content active" id="tab-logs">
                <div class="logs-section">
                    <div class="section-header">
                        <h2>Live Logs</h2>
                        <div class="actions">
                            <button id="clear-logs" class="btn btn-secondary">Clear</button>
                            <button id="pause-logs" class="btn btn-secondary">Pause</button>
                        </div>
                    </div>
                    <div class="logs-container" id="logs-container">
                        <!-- Logs will be inserted here -->
                    </div>
                </div>
            </div>

            <div class="tab-content" id="tab-inspector">
                <div class="logs-section">
                    <div class="section-header">
                        <h2>Packet Inspector</h2>
                        <div class="actions">
                            <button id="toggle-inject" class="btn btn-secondary">Inject Packet</button>
                            <button id="clear-packets" class="btn btn-secondary">Clear</button>
                            <button id="pause-packets" class="btn btn-secondary">Pause</button>
                            <button id="autoscroll-toggle" class="btn btn-secondary active" title="Auto-scroll to latest packets">Auto-scroll</button>
                            <button id="diff-packets" class="btn btn-secondary" disabled>Diff (0/2)</button>
                            <button id="export-packets" class="btn btn-secondary">Export</button>
                        </div>
                    </div>

                    <!-- Filter Bar -->
                    <div class="filter-bar">
                        <div class="filter-group">
                            <!-- Direction Filter -->
                            <div class="direction-filter btn-group">
                                <button class="btn btn-filter active" data-dir="all">All</button>
                                <button class="btn btn-filter" data-dir="up">UP -></button>
                                <button class="btn btn-filter" data-dir="down">-> UP</button>
                            </div>

                            <!-- Filter Input -->
                            <div class="filter-input-wrapper">
                                <input type="text" id="packet-filter" class="filter-input"
                                    placeholder="Filter: hex:f7 0e, len:>10, ascii:hello, /regex/">
                                <button id="filter-help" class="btn-icon filter-help-btn" title="Filter syntax help">?</button>
                            </div>

                            <!-- Filter Presets -->
                            <div class="filter-presets">
                                <select id="filter-preset-select">
                                    <option value="">Presets...</option>
                                    <optgroup label="Default">
                                        <option value="len:>50">Large Packets (>50)</option>
                                        <option value="len:<=10">Small Packets (<=10)</option>
                                        <option value="dir:up">Upstream Only</option>
                                        <option value="dir:down">Downstream Only</option>
                                    </optgroup>
                                    <optgroup label="Custom" id="custom-presets">
                                    </optgroup>
                                </select>
                                <button id="save-preset" class="btn btn-secondary" title="Save current filter as preset">Save</button>
                            </div>

                            <!-- Highlight Mode Toggle -->
                            <button id="highlight-toggle" class="btn btn-secondary" title="Highlight matching instead of filtering">Highlight</button>
                        </div>

                        <div class="column-toggles">
                            <label><input type="checkbox" checked data-col="time"> Time</label>
                            <label><input type="checkbox" checked data-col="dir"> Dir</label>
                            <label><input type="checkbox" checked data-col="len"> Len</label>
                            <label><input type="checkbox" checked data-col="hex"> Hex</label>
                            <label><input type="checkbox" checked data-col="ascii"> ASCII</label>
                        </div>
                    </div>

                    <!-- Filter Help Modal -->
                    <div id="filter-help-modal" class="modal" style="display: none;">
                        <div class="modal-content modal-small">
                            <div class="modal-header">
                                <h3>Filter Syntax Help</h3>
                                <button id="close-filter-help" class="btn-icon">Ã—</button>
                            </div>
                            <div class="filter-help-content">
                                <table class="help-table">
                                    <tr><th>Syntax</th><th>Example</th><th>Description</th></tr>
                                    <tr><td><code>dir:up</code></td><td><code>dir:up</code></td><td>Upstream only</td></tr>
                                    <tr><td><code>dir:down</code></td><td><code>dir:down</code></td><td>Downstream only</td></tr>
                                    <tr><td><code>len:N</code></td><td><code>len:10</code></td><td>Exactly N bytes</td></tr>
                                    <tr><td><code>len:>N</code></td><td><code>len:>10</code></td><td>More than N bytes</td></tr>
                                    <tr><td><code>len:<N</code></td><td><code>len:<10</code></td><td>Less than N bytes</td></tr>
                                    <tr><td><code>len:N-M</code></td><td><code>len:5-20</code></td><td>Between N and M bytes</td></tr>
                                    <tr><td><code>hex:XX</code></td><td><code>hex:f7 0e</code></td><td>Contains hex pattern</td></tr>
                                    <tr><td><code>ascii:text</code></td><td><code>ascii:hello</code></td><td>Contains ASCII text</td></tr>
                                    <tr><td><code>/regex/</code></td><td><code>/f7.{2}0e/</code></td><td>Regex match on hex</td></tr>
                                </table>
                                <p class="help-note">Combine filters with spaces: <code>dir:up len:>10 hex:f7</code></p>
                            </div>
                        </div>
                    </div>

                    <!-- Save Preset Modal -->
                    <div id="save-preset-modal" class="modal" style="display: none;">
                        <div class="modal-content modal-small">
                            <div class="modal-header">
                                <h3>Save Filter Preset</h3>
                                <button id="close-save-preset" class="btn-icon">Ã—</button>
                            </div>
                            <div class="save-preset-content">
                                <div class="form-group">
                                    <label>Preset Name</label>
                                    <input type="text" id="preset-name-input" placeholder="My Filter">
                                </div>
                                <div class="form-group">
                                    <label>Filter</label>
                                    <input type="text" id="preset-filter-preview" readonly>
                                </div>
                                <div class="modal-actions">
                                    <button id="confirm-save-preset" class="btn btn-primary">Save</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Injection Panel -->
                    <div id="inject-panel" class="inject-panel" style="display: none;">
                        <div class="inject-form">
                            <div class="form-group">
                                <label>Target</label>
                                <select id="inject-target">
                                    <option value="upstream">Upstream (Server)</option>
                                    <option value="downstream">Downstream (Clients)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Format</label>
                                <select id="inject-format">
                                    <option value="hex">Hex</option>
                                    <option value="ascii">ASCII</option>
                                </select>
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label>Data</label>
                                <input type="text" id="inject-data" placeholder="e.g. 01 02 03 or Hello">
                            </div>
                            <button id="send-packet" class="btn btn-primary">Send</button>
                        </div>
                    </div>

                    <div class="packet-table-container" id="packet-table-container">
                        <!-- Go to Latest floating button -->
                        <button id="go-to-latest" class="go-to-latest-btn" style="display: none;">
                            <span class="arrow">â†“</span>
                            <span class="new-count" id="new-packet-count">0 new</span>
                        </button>
                        <table class="packet-table">
                            <thead>
                                <tr>
                                    <th data-sort="time" class="sortable">Time</th>
                                    <th data-sort="dir" class="sortable">Direction</th>
                                    <th data-sort="len" class="sortable">Length</th>
                                    <th data-sort="hex" class="sortable">Hex</th>
                                    <th data-sort="ascii" class="sortable">ASCII</th>
                                </tr>
                            </thead>
                            <tbody id="packet-list">
                                <!-- Packets will be inserted here -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Data Inspector Panel -->
                    <div id="inspector-panel" class="inspector-panel" style="display: none;">
                        <div class="inspector-header">
                            <h3>Data Inspector</h3>
                            <button id="close-inspector" class="btn-icon">Ã—</button>
                        </div>
                        <div class="inspector-content">
                            <div class="inspector-item">
                                <span class="label">Binary</span>
                                <span class="value" id="insp-binary">-</span>
                            </div>
                            <div class="inspector-item">
                                <span class="label">Int8</span>
                                <span class="value" id="insp-int8">-</span>
                            </div>
                            <div class="inspector-item">
                                <span class="label">Uint8</span>
                                <span class="value" id="insp-uint8">-</span>
                            </div>
                            <div class="inspector-item">
                                <span class="label">Int16 (LE/BE)</span>
                                <span class="value" id="insp-int16">-</span>
                            </div>
                            <div class="inspector-item">
                                <span class="label">Uint16 (LE/BE)</span>
                                <span class="value" id="insp-uint16">-</span>
                            </div>
                            <div class="inspector-item">
                                <span class="label">Int32 (LE/BE)</span>
                                <span class="value" id="insp-int32">-</span>
                            </div>
                            <div class="inspector-item">
                                <span class="label">Uint32 (LE/BE)</span>
                                <span class="value" id="insp-uint32">-</span>
                            </div>
                            <div class="inspector-item">
                                <span class="label">Float32 (LE/BE)</span>
                                <span class="value" id="insp-float32">-</span>
                            </div>
                            <div class="inspector-item">
                                <span class="label">String</span>
                                <span class="value" id="insp-string">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- Diff Modal -->
                    <div id="diff-modal" class="modal" style="display: none;">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h3>Packet Diff</h3>
                                <button id="close-diff" class="btn-icon">Ã—</button>
                            </div>
                            <div class="diff-container">
                                <div class="diff-packet">
                                    <h4>Packet A</h4>
                                    <div id="diff-packet-a" class="diff-hex"></div>
                                </div>
                                <div class="diff-packet">
                                    <h4>Packet B</h4>
                                    <div id="diff-packet-b" class="diff-hex"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <!-- Clients Modal -->
    <div id="clients-modal" class="modal" style="display: none;">
        <div class="modal-content modal-medium">
            <div class="modal-header">
                <h3>Connected Clients</h3>
                <button id="close-clients-modal" class="btn-icon">Ã—</button>
            </div>
            <div class="clients-modal-content">
                <div class="clients-summary">
                    <div class="summary-item">
                        <span class="summary-label">TCP Clients</span>
                        <span class="summary-value" id="modal-tcp-count">0</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Web Clients</span>
                        <span class="summary-value" id="modal-web-count">0</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Total</span>
                        <span class="summary-value" id="modal-total-count">0</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Max</span>
                        <span class="summary-value" id="modal-max-clients">0</span>
                    </div>
                </div>
                <div class="clients-table-container">
                    <table class="clients-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Address</th>
                                <th>Type</th>
                                <th>Connected At</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="clients-list">
                            <!-- Client rows will be inserted here -->
                        </tbody>
                    </table>
                    <div id="no-clients-message" class="no-clients" style="display: none;">
                        No TCP clients connected
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="app.js"></script>
</body>

</html>